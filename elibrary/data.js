// Generated by CoffeeScript 1.6.2
(function() {
  var Book, book_count, gkeys, truekeys,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  window.data = {
    sections: [],
    books: [],
    sectionCounters: {},
    authors: [],
    authorSections: {}
  };

  gkeys = function(x) {
    var key, _results;

    _results = [];
    for (key in x) {
      _results.push(key);
    }
    return _results;
  };

  truekeys = function(x) {
    var key, value, _results;

    _results = [];
    for (key in x) {
      value = x[key];
      if (value) {
        _results.push(key);
      }
    }
    return _results;
  };

  Array.prototype.gkeys = function() {
    return this;
  };

  Array.prototype.filter_by = function(by_what, value, opts) {
    var filter, wby,
      _this = this;

    wby = function(x) {
      return x[by_what];
    };
    if (!by_what) {
      wby = function(x) {
        return x;
      };
    }
    if (!opts) {
      return this.filter(function(x) {
        return x[by_what] === value;
      });
    }
    if (opts["author.sections.in"]) {
      filter = function(value) {
        return function(x) {
          var flag;

          flag = false;
          data.authorSections[wby(x)].forEach(function(y) {
            if (flag) {
              return;
            }
            if (__indexOf.call(value, y) >= 0) {
              return flag = true;
            }
          });
          return flag;
        };
      };
    }
    if (opts["book.in"]) {
      filter = function(value) {
        return function(x) {
          var _ref;

          return _ref = wby(x), __indexOf.call(value, _ref) >= 0;
        };
      };
    }
    if (opts["regex"]) {
      filter = function(value) {
        return function(x) {
          return wby(x).match(value);
        };
      };
    }
    if (opts["ko.computed"]) {
      return ko.computed(function() {
        return _this.filter(filter(value()));
      });
    }
    if (opts["ko.computed.truekeys"]) {
      return ko.computed(function() {
        return _this.filter(filter(truekeys(value())));
      });
    }
    return this.filter(filter(value));
  };

  book_count = 0;

  Book = (function() {
    function Book(title, author, section) {
      var _ref, _ref1, _ref2;

      this.title = title;
      this.author = author;
      this.section = section;
      this.id = book_count;
      book_count += 1;
      if (_ref = this.author, __indexOf.call(data["authors"], _ref) < 0) {
        data["authors"].push({
          name: this.author,
          id: data["authors"].length
        });
        data["authorSections"][this.author] = [];
      }
      if (_ref1 = this.section, __indexOf.call(data["sections"], _ref1) < 0) {
        data["sections"].push(this.section);
        data["sectionCounters"][this.section] = 0;
      }
      if (_ref2 = this.section, __indexOf.call(data["authorSections"][this.author], _ref2) < 0) {
        data["authorSections"][this.author].push(this.section);
      }
      data["sectionCounters"][this.section] += 1;
    }

    return Book;

  })();

  data["books"] = [new Book("1812 год", "Клаузевиц Карл", "history"), new Book("Гибель волхва", "Осетров Н", "history"), new Book("Если б заговорил сфинкс...", "Аматуни П", "history"), new Book("Очерки Бородинского сражения", "Глинка Ф", "history"), new Book("Чингиз-хан (книга 1, 2)", "Ян Василий", "history"), new Book("Бомба №14", "Ричи Джек", "detective"), new Book("Будь моим гостем", "Найт Дэймон", "detective"), new Book("Вне закона", "Биварли Элизабет", "detective"), new Book("Раритет Гильдебранда", "Флеминг Ян", "detective"), new Book("Ритианский террор", "Найт Дэймон", "detective"), new Book("Сборник детективов", "Стаут Рекс", "detective"), new Book("Три рассказа в Гэллегере", "Каттнер Генри", "detective"), new Book("Честная игра", "Кортес Джон", "detective"), new Book("Бег по кругу", "Видар Гарм", "fantastic"), new Book("В восемь утра", "Нельсон Рэй", "fantastic"), new Book("Врата рая", "Стэблфорд Брайан", "fantastic"), new Book("Космические инженеры", "Саймак Клиффорд", "fantastic"), new Book("Линкор в нафталине", "Гаррисон Гарри", "fantastic"), new Book("Пересечение Эйнштейна", "Дилани Сэмюэль", "fantastic"), new Book("Поле боя", "Кинг Стивен", "fantastic"), new Book("Сердце звездного мира", "Блиш Джеймс", "fantastic"), new Book("Хранители", "Кристофер Джон", "fantastic"), new Book("Шестая глава «Дон Кихота»", "Штерн Борис", "fantastic"), new Book("Белый клык", "Лондон Джек", "adventures"), new Book("Золота на ветру", "Тихомирова В", "adventures"), new Book("Ким", "Киплинг Редьярд", "adventures"), new Book("Кладоискатели", "Ирвинг Вашингтон", "adventures"), new Book("Охотники на мамонтов", "Шторх Эдуард", "adventures"), new Book("Последний из могикан", "Купер Джеймс", "adventures"), new Book("Пятнадцатилетний капитан", "Верн Жюль", "adventures"), new Book("Челюсти", "Бенчли Питер", "adventures"), new Book("Великий закон доктора Строптизиуса", "Сергиевская Ирина", "humor"), new Book("Веселый солдат", "Астафьев Виктор", "humor"), new Book("Двенадцать стульев", "Ильф Илья", "humor"), new Book("Мыльный роман", "Промптов А", "humor"), new Book("Непричесанные мысли", "Лец Ежи", "humor"), new Book("Оживление", "Исаев Максим", "humor"), new Book("Срочное погружение", "Дрыжак Владимир", "humor"), new Book("Трое в одном морге, не считая собаки", "Михайличенко Елизавета", "humor"), new Book("Возьми в дорогу врача", "Соколов Кирилл", "lyrics"), new Book("Глаз", "Моррисон Джим", "lyrics"), new Book("Мертвый мороз", "Хенд Секонд", "lyrics"), new Book("Поэмы", "Купала Янка", "lyrics"), new Book("Стихи", "Киплинг Редьярд", "lyrics"), new Book("Три порции соуса жизни", "Венский Э", "lyrics"), new Book("Три яйца", "Ханинаев Виталий", "lyrics"), new Book("Эссе, новеллы, стихи", "Зейгермахер Леонид", "lyrics")];

}).call(this);
